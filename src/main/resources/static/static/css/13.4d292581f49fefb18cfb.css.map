{"version":3,"sources":["D:/项目管理/售货机/web/web/src/views/pointposition/position/D:/项目管理/售货机/web/web/src/views/pointposition/position/src/views/pointposition/position/edit.vue"],"names":[],"mappings":"AA4TA,kCAAA,UAAA,CAAA,AACA,2BAAA,WAAA,CAAA,AACA,gCAAA,kBAAA,CAAA","file":"13.4d292581f49fefb18cfb.css","sourcesContent":["<template>\n <div class=\"div-warp\">\n      <el-card class=\"box-card\">\n        <div slot=\"header\" class=\"clearfix\">\n          <span>新增区域</span>\n        </div>\n        <el-form :model=\"editForm\" :rules=\"Rules\" class=\"formWidth\" ref=\"editForm\" @submit.prevent=\"onSubmit\" >\n          <el-form-item label=\"点位编号\" prop=\"code\" size=\"small\" :label-width=\"formLabelWidth\">\n            <el-input v-model=\"editForm.code\" auto-complete=\"off\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"点位名称\" prop=\"name\" size=\"small\" :label-width=\"formLabelWidth\">\n            <el-input v-model=\"editForm.name\" auto-complete=\"off\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"线路名称\" prop=\"lineId\" size=\"small\" :label-width=\"formLabelWidth\">\n              <el-select v-model=\"editForm.lineId\" auto-complete=\"off\" placeholder=\"请选择\">\n                <el-option\n                v-for=\"item in lineList\"\n                  :key=\"item.lineId\"\n                  :label=\"item.name\"\n                  :value=\"item.lineId\">\n                </el-option>\n              </el-select>\n          </el-form-item>\n          <el-form-item label=\"所属商户\"  prop=\"corpName\" size=\"small\"  :label-width=\"formLabelWidth\">\n            <el-autocomplete\n              v-model=\"editForm.corpName\"\n              :fetch-suggestions=\"querySearchAsync\"\n              value-key=\"corpName\"\n              placeholder=\"输入搜索公司\"\n              @select=\"handleSelect\"\n\n            ></el-autocomplete>\n          </el-form-item>\n          <el-form-item label=\"所属行政区域\" prop=\"country\" size=\"small\" :label-width=\"formLabelWidth\">\n              <el-select v-model=\"editForm.country\" @change=\"getChildData('1')\" placeholder=\"请选择国家\">\n                <el-option\n                  v-for=\"item in cityList.countryData\"\n                  :key=\"item.logid\"\n                  :label=\"item.name\"\n                  :value=\"item.logid\">\n                </el-option>\n              </el-select>\n              <el-select v-model=\"editForm.province\"  @change=\"getChildData('2')\" placeholder=\"请选择省份或州\">\n                <el-option\n                  v-for=\"item in cityList.ProvinceData\"\n                  :key=\"item.logid\"\n                  :label=\"item.name\"\n                  :value=\"item.logid\">\n                </el-option>\n              </el-select>\n              <el-select v-model=\"editForm.city\"  @change=\"getChildData('3')\" placeholder=\"请选择城市\">\n                <el-option\n                  v-for=\"item in  cityList.cityData\"\n                  :key=\"item.logid\"\n                  :label=\"item.name\"\n                  :value=\"item.logid\">\n                </el-option>\n              </el-select>\n              <el-select v-model=\"editForm.district\" placeholder=\"请选择区\">\n                <el-option\n                  v-for=\"item in  cityList.DistrictData\"\n                  :key=\"item.logid\"\n                  :label=\"item.name\"\n                  :value=\"item.logid\">\n                </el-option>\n              </el-select>\n\n          </el-form-item>\n          <el-form-item label=\"详细地址\" prop=\"adderss\" size=\"small\" :label-width=\"formLabelWidth\">\n            <el-input v-model=\"editForm.adderss\" auto-complete=\"off\"></el-input>\n          </el-form-item>\n           <el-form-item label=\"经度\" prop=\"longitude\" size=\"small\" :label-width=\"formLabelWidth\">\n            <el-input v-model=\"editForm.longitude\" auto-complete=\"off\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"维度\" prop=\"latitude\" size=\"small\" :label-width=\"formLabelWidth\">\n            <el-input v-model=\"editForm.latitude\" auto-complete=\"off\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"描述\" prop=\"remark\" size=\"small\" :label-width=\"formLabelWidth\">\n            <el-input type=\"textarea\" v-model=\"editForm.remark\"></el-input>\n          </el-form-item>\n        </el-form>\n        <div class=\"dialog-footer\">\n          <el-button @click=\"ReturnLevel\">取 消</el-button>\n          <el-button type=\"primary\" @click=\"addSubmitForm('editForm')\">确 定</el-button>\n        </div>\n      </el-card>\n  </div>\n</template>\n<script>\nimport {getCompany,editPosition,getVendingDistrict,getVendingLine,getChild} from '@/api/pointposition'\nimport NProgress from 'nprogress'\nexport default {\n  data() {\n        var ValidationCompany = (rule, value, callback) => {\n            if (!value) {\n              return callback(new Error(' '));\n            }else{\n               callback();\n            }\n        };\n        return {\n          cityId:'0',\n          corpName:'',\n          lineList:[],//所有线路\n          regionList:[],//区域列表\n          restaurants: [],\n          cityList:{//省市区\n               countryData:[],//国家\n               ProvinceData:[],//省份列表\n               cityData:[],//市\n               DistrictData:[]//区县\n          },\n          companyName: '',\n          timeout:  null,\n          formLabelWidth: '120px',\n          editForm: {\n              districtId:'',\n              lineId:'',\n              code:'',\n              name:'',\n              country:'',\n              province:'',\n              city:'',\n              district:'',\n              adderss:'',\n              longitude:'',\n              latitude:'',\n              corpId:''\n          },\n          Rules:{\n              code:[\n                { required: true, message: ' ', trigger: 'blur' }\n              ],\n              name:[\n                 { required: true, message: ' ', trigger: 'blur' }\n              ],\n              lineId:[\n                 { required: true, message: ' ', trigger: 'blur' }\n              ],\n              corpName: [\n                 {  required: true, validator: ValidationCompany, trigger: 'change' }\n              ],\n              country:[\n                 { required: true, message: ' ', trigger: 'blur' }\n              ],\n              adderss:[\n                 { required: true, message: ' ', trigger: 'blur' }\n              ],\n          }\n        }\n  },\n  watch: {\n   \n  },\n  created() {\n    if(window.localStorage){\n        this.editForm = JSON.parse(localStorage.getItem(\"editData\"));\n    }\n  },\n  methods: {\n    ReturnLevel(){\n      this.$router.push(\n              {path:'/pointposition/position'}\n      );\n    },\n    addSubmitForm(formName) {//提交新增窗口\n        this.$refs[formName].validate((valid) => {\n          if (valid) {\n          this.$confirm('确认提交吗？', '提示', {}).then(() => {\n                      NProgress.start();\n                      let para = Object.assign({}, this.editForm);\n                      editPosition(para).then((res) => {\n                            if(res.zhead.reTCode==\"0000\"){\n                            NProgress.done();\n                            this.$notify({\n                              title: '成功',\n                              message: res.zhead.retMsg,\n                              type: 'success'\n                            });\n                            this.$refs['editForm'].resetFields();\n                            this.$router.push(\n                                  {path:'/pointposition/position'}\n                            );\n                            }else{\n                              this.$notify({\n                                title: '失败',\n                                message: res.zhead.retMsg,\n                                type: 'error'\n                              });\n                          }\n                      });\n          });\n          } else {\n            console.log('error submit!!');\n            return false;\n          }\n        });\n    },\n   \n    resetForm(formName) {//重置表单\n        this.$refs[formName].resetFields();\n    },\n    getData() {\n      var _this = this;\n      this.listLoading = true\n      const listQuery = {\n      }\n      getVendingDistrict(listQuery).then(response => {\n        if(response.zhead.reTCode===\"0000\"){\n        _this.regionList = response.zbody.datas.rows;\n        console.log(\"所有区域\",_this.regionList)\n        }else{\n           this.$notify({\n              title: '失败',\n              message: res.zhead.retMsg,\n              type: 'error'\n            });\n        }\n\n      })\n    },\n    getLine(){//查所有线路\n        var _this = this;\n        this.listLoading = true\n        const listQuery = {\n        }\n        getVendingLine(listQuery).then(response => {\n          if(response.zhead.reTCode===\"0000\"){\n          _this.lineList = response.zbody.datas.rows;\n          console.log(\"所有线路\",_this.lineList)\n          }else{\n             this.$notify({\n                title: '失败',\n                message: res.zhead.retMsg,\n                type: 'error'\n              });\n          }\n\n        })\n    },\n    querySearchAsync(queryString, cb) {//输入搜索托管公司\n        var restaurants = this.restaurants;\n        var results = queryString ? restaurants.filter(this.createStateFilter(queryString)) : restaurants;\n        var _this = this;\n        const listQuery = {\n          corpName:_this.companyName\n        }\n        getCompany(listQuery).then(response => {\n          _this.restaurants = response.zbody.datas\n          console.log(\"所属公司\",_this.restaurants)\n          cb(results);\n        })\n    },\n    createStateFilter(queryString) {\n        return (state) => {\n          return (state.corpName.toLowerCase().indexOf(queryString.toLowerCase()) === 0);\n        };\n    },\n    handleSelect(item) {\n        this.editForm.corpId = item.corpId\n        this.editForm.corpName = item.corpName\n        console.log(item);\n    },\n    getChildData(type){//查询行政区域\n        var _this = this;\n        let cityId=\"0\"\n         if(type ==\"1\"){\n            cityId = _this.editForm.country\n         }else if(type ==\"2\"){\n           cityId = _this.editForm.province\n         }else if(type == \"3\"){\n           cityId = _this.editForm.city\n         }\n        const listQuery = {\n          parentId:cityId\n        }\n        getChild(listQuery).then(response => {\n          if(response.zhead.reTCode===\"0000\"){\n               if(type==\"1\"){\n                  _this.cityList.ProvinceData = response.zbody.datas.rows;//省份列表\n              }else if(type==\"2\"){\n                 _this.cityList.cityData = response.zbody.datas.rows;//市\n              }else if(type==\"3\"){\n                 _this.cityList.DistrictData = response.zbody.datas.rows;//区县\n              }else{\n                 _this.cityList.countryData=response.zbody.datas.rows;//国家\n              }\n          console.log(\"行政区.ProvinceData域\",_this.lineList)\n          }else{\n             this.$notify({\n                title: '失败',\n                message: res.zhead.retMsg,\n                type: 'error'\n              });\n          }\n\n        })\n    },\n   \n  },\n\n  mounted () {\n   this.getData()\n   this.getLine()\n   this.getChildData()\n   this.getChildData(\"1\")\n   this.getChildData(\"2\")\n   this.getChildData(\"3\")\n \n  },\n  components: {\n\n  }\n}\n</script>\n<style scoped>\n  .el-autocomplete{width:100%;}\n  .div-warp{margin: 20px;}\n  .dialog-footer{ padding-left:120px;  }\n</style>"]}